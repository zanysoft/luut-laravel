/*!
 * Tiny Mentions plugin
 *
 * Copyright 2010-2021 Tiny Technologies, Inc. All rights reserved.
 *
 * Version: 2.2.1-99
 */
!function(){"use strict";function c(){}function i(t){return function(){return t}}function n(t){return parseInt(t,10)}function o(t,n){return 0==(n=t-n)?0:0<n?1:-1}function e(t,n,e){return{major:t,minor:n,patch:e}}function r(t){return(t=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(t))?e(n(t[1]),n(t[2]),n(t[3])):e(0,0,0)}function _(t,n){return!!t&&-1===function(t,n){var e=o(t.major,n.major);if(0!==e)return e;e=o(t.minor,n.minor);if(0!==e)return e;n=o(t.patch,n.patch);return 0!==n?n:0}(r([(t=t=t).majorVersion,t.minorVersion].join(".").split(".").slice(0,3).join(".")),r(n))}var u,a,l=i(!1),s=i(!0),f=(u=window,a="error",function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=u.console;e&&a in e&&e[a].apply(e,t)}),t=function(){return m},m={fold:function(t,n){return t()},is:l,isSome:l,isNone:s,getOr:v,getOrThunk:p,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:v,orThunk:p,map:t,each:c,bind:t,exists:l,forall:s,filter:t,equals:d,equals_:d,toArray:function(){return[]},toString:i("none()")};function d(t){return t.isNone()}function p(t){return t()}function v(t){return t}function g(t){return!(null==t)}function O(t,n){return t.dom.is(n,k(t))}function h(t){console.error(t)}function E(t){return t&&"string"==typeof t.id&&"string"==typeof t.name}function P(t){E(t)||h("mentions_fetch didn't produce a valid list of users.")}function A(t,n){return(n=O(t,n))||h("mentions_complete needs to produce a element that matches selector: "+k(t)),n}function C(o){function e(t,n){return"function"==typeof t?t:n}function t(t,n){var r,i=e(t,n);return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o={},e=t.map(function(t){var e;return"function"==typeof t&&(e=t,t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];o===r&&e.apply(void 0,t)}),t}),o=r={};i.apply(void 0,e)}}var n=t(o.getParam("mentions_menu_hover"),c),r=t(o.getParam("mentions_fetch"),function(t,n){n([])}),i=e(o.getParam("mentions_menu_complete"),function(t,n){var e=o.dom.create("span",{class:"mention"});return e.appendChild(o.dom.doc.createTextNode("@"+n.name)),e}),u=e(o.getParam("mentions_menu_cancel"),c);return{hover:n,fetch:r,complete:i,select:t(o.getParam("mentions_select"),c),cancel:u}}function N(e){e.on("SetContent",function(){var t,n;(t=e).$(k(t),n).prop("contentEditable","false")}),e.on("PreProcess",function(t){!function(t,n,e){n=t.$(k(t),n);n.removeAttr("contenteditable"),e||n.removeAttr(j)}(e,t.node,t.source_view)}),e.on("ResolveName",function(t){O(e,t.target)&&(t.name="mention")})}var y,b=function(e){function t(){return r}function n(t){return t(e)}var o=i(e),r={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:s,isNone:l,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:t,orThunk:t,map:function(t){return b(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?r:m},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(l,function(t){return n(e,t)})}};return r},S={some:b,none:t,from:function(t){return null==t?m:b(t)}},x=tinymce.util.Promise,t=function(n){return function(t){return typeof t===n}},w=(y="string",function(t){return t=typeof(n=t),(null===n?"null":"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t)===y;var n}),T=t("boolean"),L=t("number"),k=function(t){return t.getParam("mentions_selector",".mention","string")},j="data-mce-mentions-id",R=function(e,o){function t(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];clearTimeout(r),r=setTimeout(function(){e.apply(this,t)},o)}var r;return t.stop=function(){clearTimeout(r)},t},D=function(){return(D=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};function M(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;for(var o=Array(t),r=0,n=0;n<e;n++)for(var i=arguments[n],u=0,c=i.length;u<c;u++,r++)o[r]=i[u];return o}function H(t,n){for(var e=t.length,o=new Array(e),r=0;r<e;r++){var i=t[r];o[r]=n(i,r)}return o}function V(t,n){t.dom.appendChild(n.dom)}function q(t,n,e){var o=n.x,r=n.y,i=t.w,u=t.h,t=n.w,n=n.h;return"b"===(e=(e||"").split(""))[0]&&(r+=n),"r"===e[1]&&(o+=t),"c"===e[0]&&(r+=ot(n/2)),"c"===e[1]&&(o+=ot(t/2)),"b"===e[3]&&(r-=u),"r"===e[4]&&(o-=i),"c"===e[3]&&(r-=ot(u/2)),"c"===e[4]&&(o-=ot(i/2)),rt(o,r,i,u)}function U(t,n,e){var o=it.getViewPort();return o.w-=30,o.h-=30,o=function(t,n,e,o){for(var r,i=0;i<o.length;i++)if((r=q(t,n,o[i])).x>=e.x&&r.x+r.w<=e.w+e.x&&r.y>=e.y&&r.y+r.h<=e.h+e.y)return o[i];return null}(t,n,o,e),t=q(t,n,o||e[0]||"bl-tl")}function F(t,n,e,o){e=e,t=ut(t=t,t.dom.getRect(e)),e=it.getRect(n),e=U(e,t,o),it.setStyles(n,{position:"absolute",left:e.x,top:e.y})}function I(r,t,n,e){function i(t,n){var e=m(((o=(o=t.rng).cloneRange()).setStart(o.startContainer,o.startOffset+1),o)),o=U(ct.getRect(n.getEl()),(t=0,o=2,rt((e=e).x-t,e.y-o,e.w+2*t,e.h+2*o)),["bl-tl","tl-bl","tl-br","bl-tr"]);n.moveTo(o.x,o.y)}function u(){s&&(ct.remove(s),s=null)}function c(){u(),l&&(l.remove(),l=null)}function o(){u(),l&&l.hide()}function a(n){e(n.settings.data,function(t){n.getEl().parentNode&&0!==l.items().length&&l.visible()&&(ct.setStyles(t,{position:"absolute",left:-65535,top:-65535}),ct.add(document.body,t),function(t,n){n=U(ct.getRect(t),ct.getRect(n),["tr-tl","tl-tr","bl-br","br-bl"]);ct.setStyles(t,{left:n.x,top:n.y})}(t,n.getEl()),u(),s=t)})}var l,s,f=-1,m=function(t){var n=t.getClientRects()[0],t=r.inline?ct.getViewPort():{x:0,y:0};return ut(r,{x:n.left+t.x,y:n.top+t.y,w:n.width,h:n.height})},d=function(e){u(),l.items().each(function(t,n){t===e&&f!==n&&(e.hover(),a(e),f=n)})},p=function(){o();var t=l.items()[f];t&&n(t.settings.data)};return{isVisible:function(){return null!==l&&l.visible()},selectNext:function(){d(l.items()[f+1])},selectPrev:function(){d(l.items()[f-1])},showAt:function(o){t(function(t){var n,e;0!==t.length?(l=(l||(l=tinymce.ui.Factory.create("menu",{onhide:function(){u()},classes:"contextmenu"}).renderTo(),r.on("remove",c),l)).show(),(n=l).getEl().style.width="",n.getEl("body").style.width="",l.items().remove(),l.add((t=t,e=o.text,at.map(t,function(t){return{text:t.fullName,data:t,match:e,onclick:function(){d(this),p()},onmouseenter:function(){d(this)}}}))),l.renderNew(),l.initLayoutRect(),i(o,l),f=-1,d(l.items()[0])):l&&l.hide()})},hide:o,complete:p}}function $(t){if(null===t)return null;var n=(o=t).collapsed&&3===o.startContainer.nodeType?o.startContainer:null;if(null===n)return null;var e=t.startOffset,o=function(t,n){for(var e=n-1;0<=e;e--){if(lt.test(t.charAt(e)))return null;if("@"===t.charAt(e))break}return-1===e||n-e<2?null:t.substring(e+1,n)}(n.data,e);return null===o?null:((t=t.cloneRange()).setStart(n,e-o.length-1),t.setEnd(n,e),{text:o,rng:t})}function K(o){function r(){return $(o.selection.getRng())}function e(){var t;g(u)&&(t=u.parentNode,g(t)&&t.removeChild(u),u=null)}function i(){l.isVisible()&&a.cancel(),l.hide()}function n(t,n){t.preventDefault(),n()}var u,c={},a=C(o),l=I(o,function(n){var t=r();t&&(t={term:t.text},a.fetch(t,function(t){st.each(t,P);t=t.slice(0,10);n(st.grep(t,E))}))},function(t){var n,e=a.complete(o,t);A(o,e)&&(n=r(),e.contentEditable="false",e.setAttribute(j,t.id),c[t.id]=t,g(n)&&o.selection.setRng(n.rng),o.insertContent(e.outerHTML))},a.hover),s=function(){var t,n;o.removed||(t=r(),!!(n=t)&&1<=n.text.length?l.showAt(t):i())},t=function(t){if(l.isVisible()&&!ft.modifierPressed(t))switch(t.keyCode){case 27:n(t,i);break;case ft.UP:n(t,l.selectPrev);break;case ft.DOWN:n(t,l.selectNext);break;case ft.ENTER:case ft.TAB:n(t,l.complete)}else i()},f=function(t){t.keyCode===ft.BACKSPACE&&s(),t.keyCode!==ft.LEFT&&t.keyCode!==ft.RIGHT||i()},m=function(t){var n=t.element;O(o,n)&&!o.selection.isCollapsed()?a.select(n,function(t){t instanceof window.HTMLElement&&(e(),u=t,document.body.appendChild(t),F(o,t,n,["bl-tl","tl-bl","tl-br","bl-tr"]))}):e()};return N(o),o.on("keypress",R(s,100)),o.on("keydown",t),o.on("keyup",f),o.on("nodechange",m),o.on("remove",e),{getUsers:function(){var n=[],e=st.map(o.dom.select("["+j+"]"),function(t){return t.getAttribute(j)});return st.each(c,function(t){-1!==st.inArray(e,t.id)&&n.push(t)}),n}}}function W(t,n){return dt(t,n)?S.from(t[n]):S.none()}function B(t,n,e){!function(t,n,e){if(!(w(e)||T(e)||L(e)))throw console.error("Invalid call to Attribute.set. Key ",n,":: Value ",e,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(n,e+"")}(t.dom,n,e)}function G(t,n){return function(t,n,e){e=function(t,n){n=function(t,n){n=t.dom.getAttribute(n);return null===n?void 0:n}(t,n);return void 0===n||""===n?[]:n.split(" ")}(t,n).concat([e]);return B(t,n,e.join(" ")),!0}(t,"class",n)}function z(t,n){void 0!==t.dom.classList?t.dom.classList.add(n):G(t,n)}function J(t,n){t.dom.textContent=n}function Q(t){return"profile"!==t.type?S.none():S.some(function(t){var e=tt.fromTag("div");z(e,"tox"),z(e,"tox-mentions__card"),S.from(t.image).each(function(t){var n=tt.fromTag("img");B(n,"src",t),z(n,"tox-mentions__avatar"),V(e,n)});var o=tt.fromTag("div");z(o,"tox-mentions__container"),V(e,o);var n=tt.fromTag("div");return z(n,"tox-mentions__username"),J(n,t.name),V(o,n),S.from(t.description).map(function(t){var n=tt.fromTag("div");z(n,"tox-mentions__description"),J(n,t),V(o,n)}),e}(t.user))}function X(i){function o(){null!==g&&null!==g.parentNode&&(g.removeEventListener("mouseover",x),g.removeEventListener("mouseout",w),g.parentNode.removeChild(g)),g=null}function n(n){function e(t){o(),(g=t).addEventListener("mouseover",x),g.addEventListener("mouseout",w),g.style.position="absolute",g.style.left="-10000px",g.style.top="-10000px",z(tt.fromDom(g),"tox-mentions__card-common"),document.body.appendChild(g),F(i,g,n,["bl-tl","tl-bl","tl-br","bl-tr"])}v.select(n,function(t){t instanceof window.HTMLElement?e(t):Q(t).each(function(t){return e(t.dom)})})}function e(){o()}function r(t){return pt.clearTimeout(t)}function u(t){r(m),r(d),m=pt.setEditorTimeout(i,function(){return n(t)},0)}function c(){return h.isSet()||O(i,i.selection.getNode())&&!i.selection.isCollapsed()}function t(t){0<(t=i.dom.$(t.target).closest(k(i))).length&&(h.set(!0),u(t[0]))}function a(t){0<i.dom.$(t.target).closest(k(i)).length&&(h.clear(),c()||e())}function l(t){O(i,t.element)&&!i.selection.isCollapsed()?u(t.element):c()||w()}var s,f,m,d,p={},v=C(i),g=null,h=(b=S.none(),s=b,f={get:function(){return s},set:function(t){s=t}},{clear:function(){return f.set(S.none())},set:function(t){return f.set(S.some(t))},isSet:function(){return f.get().isSome()},on:function(t){return f.get().each(t)}}),y=i.getParam("mentions_min_chars",1,"number"),b=i.getParam("mentions_item_type","name","string"),x=function(){r(d)},w=function(){r(d),r(m),d=pt.setEditorTimeout(i,e,300)},T=_(tinymce,"5.6.0")||"name"===b?function(t,n){return{type:"autocompleteitem",value:t.id,text:t.name,meta:{user:t,tooltipWorker:n}}}:function(n,t){var e=W(n,"image").map(function(t){return{type:"cardimage",src:t,classes:["tox-mentions__avatar"],alt:n.name}}).toArray(),o=W(n,"description").map(function(t){return{type:"cardtext",text:t,classes:["tox-mentions__description"]}}).toArray();return{type:"cardmenuitem",value:n.id,label:n.name,items:M(e,[{type:"cardcontainer",direction:"vertical",items:M([{type:"cardtext",text:n.name,name:"username",classes:["tox-mentions__username"]}],o)}]),meta:{user:n,tooltipWorker:t}}};return i.ui.registry.addAutocompleter("mentions",{ch:"@",minChars:y,maxResults:10,highlightOn:["username"],onAction:function(t,n,e,o){var r;W(o,"reload").is(!0)?(o.reload,r=function(t,n){var e={};for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e}(o,["reload"]),t.reload(r)):(r=o.user,o=n,n=v.complete(i,r),A(i,n)&&(n.contentEditable="false",n.setAttribute(j,r.id),p[r.id]=r,i.selection.setRng(o),i.insertContent(n.outerHTML)),t.hide())},fetch:function(i,u,c){return new gt(function(e){var t,o,n,r;t=i,o=u,n=c,r=function(t,n){e(function(t,n){void 0===n&&(n=[]);t=H(t,function(n){return T(n,function(t){v.hover(n,t)})});if(_(tinymce,"5.0.14"))return t;n=H(n,function(t){return{value:void 0===t.value?"":t.value,text:t.text,meta:D(D({},t.meta),{reload:!0})}});return M(t,0<n.length?[{type:"separator"}]:[],n)}(t,n))},v.fetch({term:t,meta:n},function(t,n){vt.each(t,P);t=t.slice(0,o);r(vt.grep(t,E),n)})})},columns:1}),N(i),i.on("mouseover",t),i.on("mouseout",a),i.on("nodechange",l),i.on("remove",o),{getUsers:function(){var n=[],e=vt.map(i.dom.select("["+j+"]"),function(t){return t.getAttribute(j)});return vt.each(p,function(t){-1!==vt.inArray(e,t.id)&&n.push(t)}),n}}}function Y(t,n){return _(tinymce,"4.3.13")?(f("The mentions plugin requires at least 4.3.13 version of TinyMCE."),c):_(tinymce,"5.0.0")?K(t):(t.on("init",function(){var r,i;r=t,i=n,new x(function(t,n){var e=r.getParam("mentions_css_url"),o=e?e+"/":i+"/css/";S.from(null===(e=r.ui)||void 0===e?void 0:e.styleSheetLoader).getOr(tinymce.DOM.styleSheetLoader).load(o+"mentions.css",t,n)})}),X(t))}var Z=function(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},tt={fromHtml:function(t,n){n=(n||document).createElement("div");if(n.innerHTML=t,!n.hasChildNodes()||1<n.childNodes.length)throw console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return Z(n.childNodes[0])},fromTag:function(t,n){t=(n||document).createElement(t);return Z(t)},fromText:function(t,n){t=(n||document).createTextNode(t);return Z(t)},fromDom:Z,fromPoint:function(t,n,e){return S.from(t.dom.elementFromPoint(n,e)).map(Z)}},nt=("undefined"!=typeof window||Function("return this;")(),function(e,o){return{left:e,top:o,translate:function(t,n){return nt(e+t,o+n)}}}),et=nt,ot=Math.round,rt=function(t,n,e,o){return{x:t,y:n,w:e,h:o}},it=tinymce.DOM,ut=function(t,n){var e,o;return t.inline||(e=it.getPos(t.getContentAreaContainer()),o=tt.fromDom(t.getDoc()),t=void 0!==o?o.dom:document,o=t.body.scrollLeft||t.documentElement.scrollLeft,t=t.body.scrollTop||t.documentElement.scrollTop,t=et(o,t),n.x+=e.x-t.left,n.y+=e.y-t.top),n},ct=tinymce.DOM,at=tinymce.util.Tools,lt=/[\u00a0 \t\r\n]/,st=tinymce.util.Tools,ft=tinymce.util.VK,mt=Object.hasOwnProperty,dt=function(t,n){return mt.call(t,n)},pt=tinymce.util.Delay,vt=tinymce.util.Tools,gt=tinymce.util.Promise;tinymce.PluginManager.add("mentions",Y)}();